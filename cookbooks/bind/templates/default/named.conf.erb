# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.

<% @additional_config_files.each do |file| -%>
include "<%= "#{@sysconfdir}/#{file}" %>";
<% end -%>

<% @servers.each do |server| -%>
server <%= server.name %> {
  <% server.options.each do |option| -%>
  <%= option %>;
<% end -%>
};

<% end -%>
<% @keys.each do |key| -%>
key "<%= key.name %>" {
  algorithm <%= key.algorithm %>;
  secret "<%= key.secret %>";
};

<% end %>
<% if @views.length > 0 %>
<% @views.each do |view| %>
view "<%= view.name %>" {
  <% @per_view_additional_config_files.each do |file| -%>
  include "<%= "#{@sysconfdir}/#{file}" %>";
  <% end -%>
<% if view.match_clients.length > 0 -%>

  match-clients {
<% view.match_clients.each do |client| -%>
    <%= client -%>;
<% end -%>
  };
<% end -%>
<% if view.match_destinations.length > 0 -%>

  match-destinations {
<% view.match_destinations.each do |destination| -%>
    <%= destination -%>;
<% end -%>
  };
<% end -%>
<% if view.match_recursive_only %>

  match-recursive-only yes;
<% end %>
<% if view.options.length > 0 -%>
  <% view.options.each do |option| -%>
  <%= option %>;
  <% end -%>
<% end %>
<%=
  render(
    "_zones.erb", cookbook: 'bind', variables: {
      primary_zones: @primary_zones.select { |zone| zone.view == view.name },
      secondary_zones: @secondary_zones.select { |zone| zone.view == view.name },
      forward_zones: @forward_zones.select { |zone| zone.view == view.name },
      linked_zones: @linked_zones.select { |zone| zone.view == view.name },
      stub_zones: @stub_zones.select { |zone| zone.view == view.name },

    }
  ).gsub(/^(.+)$/, '  \1')
%>
  zone "." IN {
    type hint;
    file "named.ca";
  };
};
<% end %>
<% else %>
<% @per_view_additional_config_files.each do |file| -%>
include "<%= "#{@sysconfdir}/#{file}" %>";
<% end -%>
<%=
  render "_zones.erb", cookbook: 'bind', variables: {
    primary_zones: @primary_zones,
    secondary_zones: @secondary_zones,
    forward_zones: @forward_zones,
    linked_zones: [],
    stub_zones: @stub_zones,
  }
-%>

zone "." IN {
  type hint;
  file "named.ca";
};
<% end %>
